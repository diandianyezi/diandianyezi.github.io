import{_ as o,W as p,X as c,Z as n,a1 as a,$ as t,a2 as s,C as i}from"./framework-609d4fec.js";const l={},r=s(`<h1 id="开发vscode上传图片插件" tabindex="-1"><a class="header-anchor" href="#开发vscode上传图片插件" aria-hidden="true">#</a> 开发vscode上传图片插件</h1><p>由于每次上传图片需要去后台系统cdn自己上传，并且拷贝图片地址，感觉有点繁琐，所以开发一个vscode插件可以在本地上传。</p><p><strong>主要功能：</strong></p><ol><li>激活插件后，配置好上传的接口和图片前缀</li><li>在编辑器里右键选择图片后 直接上传</li><li>将图片地址 粘贴到 光标处</li></ol><p><strong>后续优化：</strong></p><ul><li>压缩图片</li><li>加测试代码</li><li>大文件上传</li></ul><h2 id="项目搭建" tabindex="-1"><a class="header-anchor" href="#项目搭建" aria-hidden="true">#</a> 项目搭建</h2><p>首先需要全局安装脚手架：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> yo generator-code
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>安装成功后，直接使用<code>yo code</code>来生成一个插件工程，根据自己的情况选择一些配置。</p><p><img src="https://raw.githubusercontent.com/diandianyezi/typora-images/master/img/57d6ca94-0278-4b30-857a-68cff0b96b31.png" alt="57d6ca94-0278-4b30-857a-68cff0b96b31"></p><p>生成的项目结构如下：</p><p><img src="https://raw.githubusercontent.com/diandianyezi/typora-images/master/img/image-20220729160251337.png" alt="image-20220729160251337"></p><p>在项目根目录，按 F5 可直接运行项目</p><ol><li><p>按F5会打开一个新的调试窗口</p></li><li><p>在调试窗口 打开 “命令面板”，输入 Hello World，会弹以下提示</p><p><img src="https://raw.githubusercontent.com/diandianyezi/typora-images/master/img/a74604c4-3437-422a-87d9-806e2dde09d3.png" alt="a74604c4-3437-422a-87d9-806e2dde09d3"></p></li></ol><h2 id="插件开发" tabindex="-1"><a class="header-anchor" href="#插件开发" aria-hidden="true">#</a> 插件开发</h2><h3 id="配置命令" tabindex="-1"><a class="header-anchor" href="#配置命令" aria-hidden="true">#</a> 配置命令</h3><p>在 <code>package.json</code>文件配置 一些参数</p><ol><li><p>启动插件命令</p></li><li><p>右键菜单-选择图片<img src="https://raw.githubusercontent.com/diandianyezi/typora-images/master/img/a25e66cc-b57a-41c5-a665-34c3ca71e514.png" alt="a25e66cc-b57a-41c5-a665-34c3ca71e514"></p></li></ol><p><img src="https://raw.githubusercontent.com/diandianyezi/typora-images/master/img/54402e88-2bbd-4a7a-a6d1-9010a1b39852.png" alt="54402e88-2bbd-4a7a-a6d1-9010a1b39852"></p><ol start="3"><li><p>需要在设置里配置的参数</p><ul><li><p>上传图片的接口</p></li><li><p>图片url的前缀</p></li></ul><p><img src="https://raw.githubusercontent.com/diandianyezi/typora-images/master/img/3892878c-3088-4f24-9617-76fdb772c74c.png" alt="3892878c-3088-4f24-9617-76fdb772c74c"></p></li></ol><h3 id="功能开发使用接口" tabindex="-1"><a class="header-anchor" href="#功能开发使用接口" aria-hidden="true">#</a> 功能开发使用接口</h3><p>配置好参数之后，在 <code>extension.js</code> 文件里开发功能 在 <code>activate</code>方法里，使用</p><ol><li><code>vscode.commands.registerTextEditorCommand</code>注册 右键菜单-选择图片的命令</li><li><code>vscode.window.showOpenDialog</code> 打开选择文件的弹窗</li><li><code>vscode.window.showInformationMessage</code> 展示提示信息</li><li><code>vscode.workspace.getConfiguration(&#39;upload_image&#39;).get(&#39;img_prefix&#39;)</code> 获取配置信息</li></ol><h3 id="伪代码" tabindex="-1"><a class="header-anchor" href="#伪代码" aria-hidden="true">#</a> 伪代码</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">addImageUrlToEditor</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> editor <span class="token operator">=</span> vscode<span class="token punctuation">.</span>window<span class="token punctuation">.</span>activeTextEditor
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>editor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> active <span class="token punctuation">}</span> <span class="token operator">=</span> editor<span class="token punctuation">.</span>selection
    <span class="token keyword">if</span> <span class="token punctuation">(</span>start<span class="token punctuation">.</span>line <span class="token operator">===</span> end<span class="token punctuation">.</span>line <span class="token operator">&amp;&amp;</span> start<span class="token punctuation">.</span>character <span class="token operator">===</span> end<span class="token punctuation">.</span>character<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在光标位置插入内容</span>
        <span class="token keyword">const</span> activePosition <span class="token operator">=</span> active
        editor<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">editBuilder</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            editBuilder<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>activePosition<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 替换内容</span>
        <span class="token keyword">const</span> selection <span class="token operator">=</span> editor<span class="token punctuation">.</span>selection
        editor<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">editBuilder</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            editBuilder<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>selection<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">activate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ....</span>
      <span class="token keyword">let</span> textEditor <span class="token operator">=</span> vscode<span class="token punctuation">.</span>commands<span class="token punctuation">.</span><span class="token function">registerTextEditorCommand</span><span class="token punctuation">(</span><span class="token string">&#39;extension.chooseImage&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 打开文件夹  vscode.window.showOpenDialog 选择图片</span>
        <span class="token keyword">const</span> api <span class="token operator">=</span> vscode<span class="token punctuation">.</span>workspace<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token string">&#39;upload_image&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;api&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> prefix <span class="token operator">=</span> vscode<span class="token punctuation">.</span>workspace<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token string">&#39;upload_image&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;img_prefix&#39;</span><span class="token punctuation">)</span>
        <span class="token comment">// uris 存放的是 图片路径</span>
        <span class="token keyword">const</span> uris <span class="token operator">=</span> <span class="token keyword">await</span> vscode<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">showOpenDialog</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">canSelectFolders</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token literal-property property">canSelectMany</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token literal-property property">filters</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">images</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;png&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;jpg&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;jpeg&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// 上传图片 获得上传之后的图片url</span>
        <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">upload</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> uris<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// 图片Url 粘贴到 光标处</span>
        <span class="token function">addImageUrlToEditor</span><span class="token punctuation">(</span>prefix <span class="token operator">+</span> url<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​</p><h2 id="使用前配置" tabindex="-1"><a class="header-anchor" href="#使用前配置" aria-hidden="true">#</a> 使用前配置</h2><p>上传接口：<code>upload_image.api</code> 图片前缀：<code>upload_image.image_prefix</code></p><h2 id="发布插件" tabindex="-1"><a class="header-anchor" href="#发布插件" aria-hidden="true">#</a> 发布插件</h2>`,30),d={href:"https://code.visualstudio.com/api/working-with-extensions/publishing-extension",target:"_blank",rel:"noopener noreferrer"},u=s(`<p>发布过程都依赖 <code>vsce</code>工具，安装方式：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> i vsce <span class="token parameter variable">-g</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="发布方式" tabindex="-1"><a class="header-anchor" href="#发布方式" aria-hidden="true">#</a> 发布方式：</h3><ol><li>直接将文件夹发给别人，找到vscode插件的存放目录并放进去，然后重启vscode；</li><li>打包成<code>vsix</code>插件，发送给别人安装；</li><li>注册开发者账号，发布到官方应用市场，不需要审核。</li></ol><h3 id="本地打包方式" tabindex="-1"><a class="header-anchor" href="#本地打包方式" aria-hidden="true">#</a> 本地打包方式：</h3><p>打包成<code>vsix</code>文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>vsce package
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="在线发布方式" tabindex="-1"><a class="header-anchor" href="#在线发布方式" aria-hidden="true">#</a> 在线发布方式</h3>`,8),k={href:"https://account.microsoft.com/?lang=zh-CN&refd=account.live.com&refp=landing&mkt=ZH-CN",target:"_blank",rel:"noopener noreferrer"},m=s("<li>创建<code>token</code><ul><li>点击右上角的个人信息<code>security</code>，再点击<code>create token</code></li><li>name随便填写，<code>expires In</code>最好选最长时间，<code>Accounts一定要选All accessible accounts</code>，<code>Authorized Scopes</code>选择 <code>All Scopes</code>。</li><li>create后会给你一个<code>token</code>值，它只显示一次，务必要保留，之后命令行操作会使用到。</li></ul></li><li>借助vsce工具上传到商店。 <ol><li><code>vsce create-publisher (name)</code> 创建publisher，这个步骤会让你填写name、email以及上步获得的<code>token</code></li><li><code>vsce publish (version)</code> 发布到在线商店（依赖于上一步，已创建<code>publisher</code>并登录）</li></ol></li>",2),v={id:"注意事项",tabindex:"-1"},h=n("a",{class:"header-anchor",href:"#注意事项","aria-hidden":"true"},"#",-1),b={href:"https://lq782655835.github.io/blogs/tools/vscode-plugin-develop.html#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9",target:"_blank",rel:"noopener noreferrer"},g=s('<ul><li>类似npm包，README.md文件默认会显示在插件主页；</li><li>增量发布可以修改package.json的version外，还可以使用代号：<code>major/minor/patch</code>，如：vsce publish patch</li></ul><h2 id="遇到的问题" tabindex="-1"><a class="header-anchor" href="#遇到的问题" aria-hidden="true">#</a> 遇到的问题</h2><ol><li>上传接口一直报 411，需要设置一下 请求头<code>content-length</code></li></ol><p><img src="https://raw.githubusercontent.com/diandianyezi/typora-images/master/img/168f4e4d-b032-4791-ae38-e25395970c5b.png" alt="168f4e4d-b032-4791-ae38-e25395970c5b"></p><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考" aria-hidden="true">#</a> 参考：</h2><p>https://code.visualstudio.com/api/get-started/your-first-extension https://mp.weixin.qq.com/s/1dicIWW6XFyimmRxZmidbg</p>',6);function f(_,w){const e=i("ExternalLinkIcon");return p(),c("div",null,[r,n("p",null,[n("a",d,[a("官方发布插件教程"),t(e)])]),u,n("ol",null,[n("li",null,[a("在"),n("a",k,[a("Visual Studio Team Services (opens new window)"),t(e)]),a("创建一个账号")]),m]),n("h4",v,[h,a(),n("a",b,[a("#"),t(e)]),a("注意事项")]),g])}const x=o(l,[["render",f],["__file","2022-07-29-开发一个vscode上传图片的插件.html.vue"]]);export{x as default};
